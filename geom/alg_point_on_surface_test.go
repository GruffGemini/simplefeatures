package geom_test

import (
	"strconv"
	"testing"
)

func TestPointOnSurface(t *testing.T) {
	for i, tt := range []struct {
		inputWKT  string
		outputWKT string
	}{
		{"POINT EMPTY", "POINT EMPTY"},
		{"POINT(1 2)", "POINT(1 2)"},
		{"LINESTRING EMPTY", "POINT EMPTY"},
		{"LINESTRING(1 2,3 4)", "POINT(1 2)"},
		{"LINESTRING(3 4,1 2)", "POINT(3 4)"},
		{"LINESTRING(5 3,2 8,1 0)", "POINT(2 8)"},
		{"LINESTRING(1 1,2 2,100 100)", "POINT(2 2)"},
		{"LINESTRING(1 1,2 2,100 100,101 101)", "POINT(2 2)"},
		{"LINESTRING(1 1,2 2,100 100,101 101,102 102)", "POINT(100 100)"},
		{"LINESTRING(1 1,100 100,101 101,102 102,103 103)", "POINT(100 100)"},
		{"LINESTRING(1 1,1 1,2 2)", "POINT(1 1)"},
		{"LINESTRING(1 1,1 1,1 1,2 2)", "POINT(1 1)"},
		{"LINESTRING(1 1,1 1,1 1,1 1,2 2)", "POINT(1 1)"},
		{"LINESTRING(1 1,2 2,2 2)", "POINT(2 2)"},
		{"LINESTRING(1 1,2 2,2 2,2 2)", "POINT(2 2)"},
		{"LINESTRING(1 1,2 2,2 2,2 2,2 2)", "POINT(2 2)"},
		{"LINESTRING(6 6,7 7,8 8,9 9,10 10,1 1,2 2,3 3,4 4,11 11)", "POINT(7 7)"},
		{"LINESTRING(6 6,7 7,6 6,8 8,9 9,10 10,1 1,2 2,3 3,4 4,11 11)", "POINT(6 6)"},
		{"LINESTRING(1 1,0 0,1 1,2 2,1 1)", "POINT(1 1)"},
		{"POLYGON EMPTY", "POINT EMPTY"},
		{"POLYGON((0 0,0 1,1 1,1 0,0 0))", "POINT(0.5 0.5)"},
		{"POLYGON((0 0,0 1,1 0,0 0))", "POINT(0.25 0.5)"},
		{"POLYGON((0 0,3 0,3 3,0 3,0 0),(1 1,2 1,2 2,1 2,1 1))", "POINT(0.5 1.5)"},
		{"POLYGON((0 0,4 0,4 3,0 3,0 0),(1 1,2 1,2 2,1 2,1 1))", "POINT(3 1.5)"},
		{"POLYGON((0 0,0 1,0 2,2 2,2 0,0 0))", "POINT(1 1.5)"},
		{"POLYGON((0 0,0 1,0 1.5,0 2,2 2,2 0,0 0))", "POINT(1 1.25)"},
		{"POLYGON((0 0,0 0.5,0 1,0 2,2 2,2 0,0 0))", "POINT(1 1.5)"},
		{"POLYGON((0 0,1 0,1 2,2 1.5,3 2,3 3,0 3,0 0))", "POINT(0.5 1.75)"},
		{"POLYGON((0 0,3 0,3 3,0 3,0 0),(1.5 1.5,2 2,1.5 2.5,1 2,1.5 1.5))", "POINT(0.625 1.75)"},
		{"MULTIPOINT EMPTY", "POINT EMPTY"},
		{"MULTIPOINT(EMPTY)", "POINT EMPTY"},
		{"MULTIPOINT(1 2,3 4)", "POINT(1 2)"},
		{"MULTIPOINT(1 2,3 4,5 6)", "POINT(3 4)"},
		{"MULTIPOINT(3 4,1 2,5 6)", "POINT(3 4)"},
		{"MULTIPOINT(1 2,3 4,5 6,7 8)", "POINT(3 4)"},
		{"MULTIPOINT(1 2,3 4,5 6,7 8,9 10)", "POINT(5 6)"},
		{"MULTILINESTRING EMPTY", "POINT EMPTY"},
		{"MULTILINESTRING(EMPTY)", "POINT EMPTY"},
		{"MULTILINESTRING((0 0,1 1),(2 2,3 3))", "POINT(1 1)"},
		{"MULTILINESTRING((0 0,1 1,2 2,3 3),(4 4,5 5))", "POINT(2 2)"},
		{"MULTILINESTRING((0 0,1 1,2 2,3 3),(4 4,5 5),(2.2 2.2,2.3 2.3))", "POINT(2 2)"},
		{"MULTILINESTRING((0 0,1 1,2 2,3 3),(4 4,5 5),(6 6,7 7))", "POINT(2 2)"},
		{"MULTILINESTRING((0 0,1 1,2 2,3 3),(4 4,5 5),(6 6,7 7,8 8,9 9))", "POINT(2 2)"},
		{"MULTILINESTRING((0 0,1 1,2 2,3 3),(4 4,5 5),(6 6,7 7,8 8,9 9,10 10))", "POINT(7 7)"},
		{"MULTILINESTRING((0 0,1 1,2 2,3 3),(4 4,5 5),(6 6,7 7,8 8,9 9,10 10,1 1))", "POINT(7 7)"},
		{"MULTILINESTRING((0 0,1 1,2 2,3 3,2 2),(4 4,5 5),(6 6,7 7,8 8,9 9,10 10,1 1))", "POINT(7 7)"},
		{"MULTILINESTRING((0 0,1 1),(0.4 0.4,0.6 0.6))", "POINT(0.4 0.4)"},
		{"MULTILINESTRING((0 0,1 1),(0.3 0.3,0.6 0.6))", "POINT(0.6 0.6)"},
		{"MULTILINESTRING((0 0,1 1,3 3),(1.4 1.4,1.6 1.6))", "POINT(1 1)"},
		{"MULTIPOLYGON EMPTY", "POINT EMPTY"},
		{"MULTIPOLYGON(((0 0,2 0,1 1,2 2,0 2,0 0)),((2 0,4 0,4 2,2 2,3 1,2 0)))", "POINT(0.75 1.5)"},
		{"MULTIPOLYGON(((0 0,2 0,2 2,0 2,0 0),(0.5 0.5,1 0.5,1 1.5,0.5 1.5,0.5 0.5)),((2 0,5 0,5 2,4 2,2 0)))", "POINT(4 1)"},
		{"MULTIPOLYGON(((0 0,1 0,1 1,0 1,0 0)),((2 2,3 2,3 3,2 3,2 2)))", "POINT(0.5 0.5)"},
		{"MULTIPOLYGON(((0 0,1 0,1 1,0 1,0 0)),((1 1,2 1,2 2,1 2,1 1)))", "POINT(0.5 0.5)"},
		{"MULTIPOLYGON(((0 0,1 0,1 1,0 1,0 0)),((1 1,3 1,3 3,1 3,1 1)))", "POINT(2 2)"},
		{"GEOMETRYCOLLECTION EMPTY", "POINT EMPTY"},
		{"GEOMETRYCOLLECTION(POINT(1 2),POINT(3 4))", "POINT(1 2)"},
		{"GEOMETRYCOLLECTION(LINESTRING EMPTY, POINT(1 2),POINT(3 4))", "POINT EMPTY"},
		{"GEOMETRYCOLLECTION(POLYGON((0 0,0 1,1 1,1 0,0 0)),POINT(0.5 0.5))", "POINT(0.5 0.5)"},
		{"GEOMETRYCOLLECTION(POLYGON((0 0,0 2,2 2,2 0,0 0)),POLYGON((1 1,1 3,3 3,3 1,1 1)))", "POINT(1 1)"},
		{"GEOMETRYCOLLECTION(POLYGON((0 0,0 2,2 2,2 0,0 0)),POLYGON((1 1,1 4,4 4,4 1,1 1)))", "POINT(2.5 2.5)"},
		{"GEOMETRYCOLLECTION(POLYGON((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1)),POINT(1.5 1.5))", "POINT(0.5 1.5)"},
		{"GEOMETRYCOLLECTION(POLYGON((0 0,0 3,3 3,3 0,0 0),(1 1,1 2,2 2,2 1,1 1)),LINESTRING(1.4 1.4,1.6 1.6))", "POINT(0.5 1.5)"},
		{"GEOMETRYCOLLECTION(LINESTRING(0 0,1 1),POINT(0.5 0.5))", "POINT(0 0)"},

		// These cases are from failed GEOS comparison tests:
		{"GEOMETRYCOLLECTION(LINESTRING(1 0,0 5,5 2),POINT(2 3),MULTIPOLYGON EMPTY)", "POINT EMPTY"},
		{"GEOMETRYCOLLECTION(LINESTRING(5 2,0 5,1 0),POINT(2 3),MULTIPOLYGON EMPTY)", "POINT EMPTY"},
		{"GEOMETRYCOLLECTION(POINT(1 2),MULTILINESTRING EMPTY)", "POINT EMPTY"},
		{"GEOMETRYCOLLECTION(POINT(1 2),MULTIPOLYGON EMPTY)", "POINT EMPTY"},
		{"GEOMETRYCOLLECTION(POINT(1 2),POLYGON EMPTY)", "POINT EMPTY"},
		//{"GEOMETRYCOLLECTION(POINT(1 2),POINT EMPTY,LINESTRING(1 2,3 4),GEOMETRYCOLLECTION(POINT EMPTY,LINESTRING(5 6,7 8),GEOMETRYCOLLECTION(POINT EMPTY,POINT(5 6)),POINT(3 4)),GEOMETRYCOLLECTION(GEOMETRYCOLLECTION(POINT(9 10),POINT EMPTY),POINT(11 12),POINT EMPTY))", "POINT(3 4)"},
		//{"GEOMETRYCOLLECTION(POLYGON((0 0,0 1,1 0,0 0)),POLYGON((2 0,2 1,3 0,2 0)))", "POINT(0.25 0.5)"},
		{"LINESTRING(0 0,3 3)", "POINT(0 0)"},
		{"LINESTRING(0 2,3 5)", "POINT(0 2)"},
		{"LINESTRING(7 8,5 6,3 4,1 2)", "POINT(5 6)"},
		//{"MULTILINESTRING((1 2,3 4,5 6),(7 8,9 10,11 12))", "POINT(9 10)"},
		//{"MULTIPOLYGON(((0 0,0 10,10 0,0 0),(2 2,2 7,7 2,2 2)),((100 100,100 110,110 100,100 100),(102 102,102 107,107 102,102 102)))", "POINT(1 4.5)"},
		//{"MULTIPOLYGON(((0 0,1 0,1 1,0 1,0 0)),((3 4,5 6,9 5,12 8,5 11,3 4)))", "POINT(7.428571428571429 7)"},
		//{"MULTIPOLYGON(((30 20,45 40,10 40,30 20)),((15 5,40 10,10 20,5 10,15 5)))", "POINT(28.75 30)"},
	} {
		t.Run(strconv.Itoa(i), func(t *testing.T) {
			input := geomFromWKT(t, tt.inputWKT)
			got := input.PointOnSurface()
			t.Logf("input: %v", tt.inputWKT)
			expectGeomEq(t, got.AsGeometry(), geomFromWKT(t, tt.outputWKT))
		})
	}
}
